<template>
  <!-- –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å - –æ–±—ã—á–Ω–∞—è RouterLink -->
  <RouterLink v-if="allowed" :to="to" class="nav-link" active-class="active">
    <slot />
  </RouterLink>

  <!-- –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ—Ç - –≤–µ–¥—ë–º –≤ marketplace —Å locked/from -->
  <RouterLink
      v-else
      :to="lockedTo"
      class="nav-link locked"
      title="–§–∏—á–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏"
  >
    <span class="lock">üîí</span>
    <slot />
  </RouterLink>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useRoute } from 'vue-router';
import { useEntitlementsStore } from '@/shared/stores/entitlements';
import type { FeatureCode } from '@/modules/marketplace/types';

const props = defineProps<{
  to: string;
  feature?: FeatureCode; // –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω - —ç—Ç–æ ‚Äú–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π‚Äù –ø—É–Ω–∫—Ç –º–µ–Ω—é
}>();

const route = useRoute();
const ent = useEntitlementsStore();

const allowed = computed(() => {
  if (!props.feature) return true;
  return ent.has(props.feature);
});

const lockedTo = computed(() => {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
  const from = route.fullPath;

  return {
    path: '/app/marketplace',
    query: {
      locked: props.feature,
      from,
    },
  };
});
</script>

<style scoped>
.nav-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  color: #0f172a;
  text-decoration: none;
}

.nav-link:hover {
  text-decoration: underline;
}

.nav-link.active {
  font-weight: 800;
}

.nav-link.locked {
  opacity: 0.85;
}

.lock {
  font-size: 14px;
  line-height: 1;
}
</style>